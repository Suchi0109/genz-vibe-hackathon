<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Gemini Chat | GenZ Vibes</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',sans-serif; }
  html, body { height:100%; transition:0.3s; }
  body.dark { background:#121212; color:#f0f0f0; }
  body.light { background:#f9f9f9; color:#111; }

  /* NAVBAR */
  .top-nav{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;position:sticky;top:0;z-index:100;border-bottom:2px solid #00e5ff;transition:0.3s;}
  body.dark .top-nav { background:#1f1f1f; }
  body.light .top-nav { background:#fff; }
  .top-nav .logo{font-size:1.2rem;font-weight:bold;color:#00e5ff;}
  .top-nav ul{display:flex;list-style:none;gap:1rem;}
  .top-nav ul li a{color:inherit;text-decoration:none;font-weight:500;transition:0.3s;}
  .top-nav ul li a:hover,.top-nav ul li a.active{color:#00e5ff;}
  .top-nav .controls { display:flex; gap:0.5rem; align-items:center; }

  .theme-toggle-btn, #logout-btn { background:#00e5ff;border:none;padding:6px 12px;border-radius:8px;cursor:pointer;font-weight:bold;color:#121212; }

  /* Hamburger */
  .hamburger { display:none; flex-direction:column; cursor:pointer; gap:4px; }
  .hamburger div { width:25px; height:3px; background:#00e5ff; transition:0.3s; }
  @media(max-width:768px){
    .top-nav ul{display:none; flex-direction:column; width:100%; margin-top:0.5rem; }
    .top-nav ul.show{display:flex;}
    .hamburger{display:flex;}
  }

  /* CHAT AREA */
  #chat{flex:1; padding:15px; overflow-y:auto; scroll-behavior:smooth; margin-bottom:80px;}
  .msg{display:flex;margin-bottom:12px;}
  .msg.user{justify-content:flex-end;}
  .bubble{padding:10px 14px;border-radius:14px;max-width:85%;white-space:pre-wrap;line-height:1.5;}
  .msg.user .bubble{background:#4f46e5;color:#fff;}
  .msg.bot .bubble{background:#fff;border:1px solid #ddd;}
  body.dark .msg.bot .bubble{background:#1a1a1a;border:1px solid #333;color:#eee;}

  /* FOOTER INPUT */
  footer{position:fixed;bottom:0;left:0;right:0;padding:10px 15px;background:#121212;border-top:2px solid #00e5ff;}
  body.light footer{background:#fff;border-color:#ddd;}
  .row{display:flex;gap:0.5rem;align-items:center;}
  textarea{flex:1;resize:none;padding:10px;border-radius:8px;border:1px solid #00e5ff;background:transparent;color:inherit;font-size:1rem;max-height:100px;overflow-y:auto;}
  textarea:focus{border-color:#4f46e5;box-shadow:0 0 6px #00e5ff;}
  button{padding:8px 14px;border-radius:8px;border:1px solid #00e5ff;background:transparent;color:#00e5ff;font-size:1rem;cursor:pointer;transition:.2s;}
  button:hover{background:#00e5ff;color:#121212;}
  button:disabled{opacity:.5;cursor:not-allowed;}

  /* Typing indicator */
  .typing{display:flex;gap:5px;}
  .dot{width:8px;height:8px;border-radius:50%;background:gray;animation:bounce 1.4s infinite;}
  .dot:nth-child(2){animation-delay:.2s;}
  .dot:nth-child(3){animation-delay:.4s;}
  @keyframes bounce{0%,80%,100%{transform:scale(.6);opacity:.5;}40%{transform:scale(1);opacity:1;}}
  .username{color:#00e5ff;animation:bounceName 1s infinite;}
  @keyframes bounceName{0%,100%{transform:translateY(0);}50%{transform:translateY(-4px);}}
</style>
</head>
<body>
<nav class="top-nav">
  <div class="logo">Gemini Chat <span id="userName"></span></div>
  <div class="hamburger" id="hamburger"><div></div><div></div><div></div></div>
  <ul id="nav-links">
    <li><a href="home.html">Home</a></li>
    <li><a href="about_us.html">About Us</a></li>
    <li><a href="career_builder.html">Careers</a></li>
    <li><a href="quiz.html">Career Quiz üöÄ</a></li>
    <li><a href="gemini.html" class="active">Gemini AI ‚ôä</a></li>
    <li><a href="admin.html">Queries</a></li>
    <li><a href="contact.html">Contact</a></li>
    <li><a href="login.html" id="loginLink">Login / Register</a></li>
    <li><button id="logout-btn" style="display:none;">Logout</button></li>
  </ul>
  <div class="controls">
    <button id="theme-toggle-btn">‚òÄÔ∏è/üåô</button>
  </div>
</nav>

<div id="chat"></div>

<footer>
  <div class="row">
    <textarea id="userInput" rows="1" placeholder="Type your message..."></textarea>
    <button id="sendBtn">Send</button>
  </div>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "AUTHO_DOMAIN",
  projectId: "PROJECT_ID",
  storageBucket: "STORAGE_BUCKET",
  messagingSenderId: "MESSAGING_ID",
  appId: "APP_ID",
  measurementId: "MEASUREMENT_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Theme toggle
const themeToggle = document.getElementById("theme-toggle-btn");
const savedTheme = localStorage.getItem("theme") || "dark";
document.body.classList.add(savedTheme);
themeToggle.onclick = () => {
  document.body.classList.toggle("dark");
  document.body.classList.toggle("light");
  localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
};

// Hamburger
const hamburger = document.getElementById("hamburger");
const navLinks = document.getElementById("nav-links");
hamburger.onclick = () => navLinks.classList.toggle("show");

// Elements
const userNameEl = document.getElementById("userName");
const chat = document.getElementById("chat");
const input = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");
const loginLink = document.getElementById("loginLink");
const logoutBtn = document.getElementById("logout-btn");

// Auth check
onAuthStateChanged(auth, async (user) => {
  if (!user) { window.location.href = "login.html"; return; }
  loginLink.style.display = "none";
  logoutBtn.style.display = "inline-block";

  const q = query(collection(db,"users"), where("email","==",user.email));
  const snap = await getDocs(q);
  let fullName = user.email;
  snap.forEach(doc => { if(doc.data().fullName) fullName = doc.data().fullName; });
  userNameEl.innerHTML = `<span class="username">${fullName}</span>`;
});

// Logout
logoutBtn.onclick = async () => { await signOut(auth); window.location.href = "login.html"; };

// Chat
sendBtn.onclick = sendMessage;
input.addEventListener("keydown", e => { if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); sendMessage(); } });

const DEFAULT_API_KEY = "GEMINI_API_KEY"; 
let apiKey = localStorage.getItem("apiKey") || DEFAULT_API_KEY;

async function sendMessage(){
  const text = input.value.trim();
  if(!text) return;
  addMessage("user",text);
  input.value="";
  addTyping();

  try{
    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`, {
      method:"POST", headers:{"Content-Type":"application/json"},
      body:JSON.stringify({contents:[{parts:[{text}]}]})
    });
    const data = await res.json();
    removeTyping();
    const reply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "‚ö†Ô∏è No reply (check API key)";
    addMessage("bot",reply);
  } catch(err) { removeTyping(); addMessage("bot","‚ùå Error: "+err.message); }
}

function addMessage(sender,text){
  const msg = document.createElement("div"); msg.className = "msg "+sender;
  const bubble = document.createElement("div"); bubble.className="bubble"; bubble.textContent=text;
  msg.appendChild(bubble); chat.appendChild(msg); chat.scrollTop = chat.scrollHeight;
}

function addTyping(){
  const msg = document.createElement("div"); msg.className="msg bot typing"; msg.id="typing";
  msg.innerHTML='<div class="bubble"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>';
  chat.appendChild(msg); chat.scrollTop = chat.scrollHeight;
}

function removeTyping(){ const t = document.getElementById("typing"); if(t) t.remove(); }
</script>
</body>
</html>
